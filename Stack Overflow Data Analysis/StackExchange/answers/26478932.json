{"title": "asp.net - how to pass a formulated column from SQL stored procedure / query to Crystal Report", "tags": ["c#", "sql", "asp.net", "crystal-reports", "reporting"], "creation_date": 1413865884, "score": 1, "body": "<p>Change your Report Datasource From the table you are using to ttx like below</p>\n\n<ul>\n<li>Step 1 : Open your DailySalesTenderReport.rpt in your crystal Report .</li>\n</ul>\n\n<p><a href=\"http://imgur.com/gEADO6I\" rel=\"nofollow\"><img src=\"http://i.imgur.com/gEADO6I.png\" title=\"source: imgur.com\" /></a>\n - Step 2 : Note Table type in your case it will be \"Table\" not view. Click the \"create new connection below.\"</p>\n\n<p><a href=\"http://imgur.com/zo9uyfD\" rel=\"nofollow\"><img src=\"http://i.imgur.com/zo9uyfD.jpg\" title=\"source: imgur.com\" /></a></p>\n\n<ul>\n<li><p>Step 3 : Select \"Field Definition option \"\n<a href=\"http://imgur.com/ccwmsJR\" rel=\"nofollow\"><img src=\"http://i.imgur.com/ccwmsJR.jpg\" title=\"source: imgur.com\" /></a></p></li>\n<li><p>Step 4 : A window like the one below will pop up. Key in your column and select the type and click add button. Below is how i add the columns upto the 'GSC'. </p></li>\n</ul>\n\n<p><a href=\"http://imgur.com/R4jiep7\" rel=\"nofollow\"><img src=\"http://i.imgur.com/R4jiep7.png\" title=\"source: imgur.com\" /></a></p>\n\n<ul>\n<li><p>Step 5 : When you finish click the window close it will prompt a message like below. Click yes and save the file with name you like \n<a href=\"http://imgur.com/6KfFa3Q\" rel=\"nofollow\"><img src=\"http://i.imgur.com/6KfFa3Q.png\" title=\"source: imgur.com\" /></a></p>\n\n<ul>\n<li>Step 6 : After you save your file. Click the finish button like below. </li>\n</ul></li>\n</ul>\n\n<p><a href=\"http://imgur.com/sItcks9\" rel=\"nofollow\"><img src=\"http://i.imgur.com/sItcks9.jpg\" title=\"source: imgur.com\" /></a></p>\n\n<ul>\n<li>Step 7 : Finally . Select your newly created file , selec your existing source on top. and then click update. Save your report again and it should work fine.</li>\n</ul>\n\n<p><a href=\"http://imgur.com/FpU307E\" rel=\"nofollow\"><img src=\"http://i.imgur.com/FpU307E.png\" title=\"source: imgur.com\" /></a></p>\n\n<p>Changing the Report datasource to ttx should work for you. Let me know if there is any issue.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Alternatively, you can simply achieve this with stored procedure, kind of more reliable and easy to debug. JUst change your datasource to SQL stored procedure, but first create the procedure</p>\n\n<pre><code>   CREATE PROCEDURE [dbo].[Myprocedure]\n    @datefrom DATETIME= null, -- This may string defending on what you intended.\n    @dateTo DATETIME = NULL,\n    @hdnRP nvarchar(50), --Size or dataype depend on you.\n\n    AS\n      begin\n\nif  (@dateTo = '' or  Len(@dateTo) = 0) AND (@dateFrom = '' or  Len(@dateFrom) = 0) AND (@hdnRP = '' or  Len(@hdnRP ) = 0) )\n  begin\n    select   b.name , convert(varchar(10), a.date, 101) as Date, \n                         datename(weekday, a.date) as Day,\n                         convert(varchar,cast(SUM(a.surcharge ) as money),1) AS Surcharge, \n                         convert(varchar,cast(SUM(a.senior)  as money),1) as senior, \n                         convert(varchar,cast((((SUM(a.senior))/0.20)*0.80)  as money),1) as VATExemptSales,\n                         convert(varchar,cast(SUM(a.other)  as money),1) as Other, \n                         convert(varchar,cast(SUM(a.refund)  as money),1)as Refund, \n                         convert(varchar,cast(SUM(a.void)  as money),1) as Void, \n\n                         CASE WHEN a.date IN (select Z.date from discount z) \n                          THEN (convert(varchar,cast(((sum(a.cash) + SUM(a.charge) + SUM(a.gift)) - (SUM(a.surcharge))) as money),1) )\n                          ELSE convert(varchar,cast(((sum(a.cash) + SUM(a.charge) + SUM(a.gift)+ SUM(a.other)) - (SUM(a.surcharge))) as money),1) \n                          END as GSC, \n\n                        convert(varchar,cast(SUM(a.cash ) as money),1) as Cash,  \n                        convert(varchar,cast(SUM(a.charge ) as money),1) as Charge, \n                        convert(varchar,cast(SUM(a.gift ) as money),1) as Gift\n\n                        from  TENANT b inner join LOCATION c on b.location=c.location inner join DAILY a on a.tenantcode=b.tenantcode   \n\n                    GROUP BY a.tenantcode, b.name, a.date order by  a.date \"\n\nend\n\nELSE \n begin\n\n   select   b.name , convert(varchar(10), a.date, 101) as Date, \n                         datename(weekday, a.date) as Day,\n                         convert(varchar,cast(SUM(a.surcharge ) as money),1) AS Surcharge, \n                         convert(varchar,cast(SUM(a.senior)  as money),1) as senior, \n                         convert(varchar,cast((((SUM(a.senior))/0.20)*0.80)  as money),1) as VATExemptSales,\n                         convert(varchar,cast(SUM(a.other)  as money),1) as Other, \n                         convert(varchar,cast(SUM(a.refund)  as money),1)as Refund, \n                         convert(varchar,cast(SUM(a.void)  as money),1) as Void, \n\n                         CASE WHEN a.date IN (select Z.date from discount z where z.date between            @datefrom  and @dateTo  and z.tenantcode = @hdnRP) \n                          THEN (convert(varchar,cast(((sum(a.cash) + SUM(a.charge) + SUM(a.gift)) - (SUM(a.surcharge))) as money),1) )\n                          ELSE convert(varchar,cast(((sum(a.cash) + SUM(a.charge) + SUM(a.gift)+ SUM(a.other)) - (SUM(a.surcharge))) as money),1) \n                          END as GSC, \n\n                        convert(varchar,cast(SUM(a.cash ) as money),1) as Cash,  \n                        convert(varchar,cast(SUM(a.charge ) as money),1) as Charge, \n                        convert(varchar,cast(SUM(a.gift ) as money),1) as Gift\n\n                        from  TENANT b inner join LOCATION c on b.location=c.location inner join DAILY a on a.tenantcode=b.tenantcode   \n\n                       where (a.date between @dateFrom and @dateTo)  and (a.tenantcode = @hdnRP) GROUP BY a.tenantcode, b.name, a.date order by  a.date \"\n\n\n  END    \nEnd \n</code></pre>\n\n<p>After you create your procedure, go to your .rpt report , open and change the data source to SQL data source, navigate through and select your procedure , then update just like with ttx but here Sql data source. When you update, Your columns will come under the report and under the parameter , u would have have three parameters. @datFrom, @datTo, @hdnRP . Modify your page load you will not be needing the dataset.</p>\n\n<pre><code>  ReportDocument report = new ReportDocument();\n  report.SetParameterValue(0, Loc);\n  report.SetParameterValue(1, Label2.Text);\n  report.SetParameterValue(2, Label3.Text);\n  report.SetParameterValue(3, Label4.Text);\n  crViewer.ReportSource = report; //crViewver is your crystal report viewer name.\n</code></pre>\n\n<p>I suppose you know how to use your parameters also. Hope this, works. </p>\n\n<p><strong>Update</strong></p>\n\n<p>I think i have seen something similar. Its bcos of the complexity of ur procedure. There are similar questions on how to supressed this <a href=\"https://social.msdn.microsoft.com/Forums/en-US/b71be49e-303d-4ad9-8e3e-431e943361e0/how-to-suppress-enter-parameter-values-screen-in-crystal-reports-for-visual-studio-2010?forum=vscrystalreports\" rel=\"nofollow\">here</a> and <a href=\"https://social.msdn.microsoft.com/Forums/en-US/0eb90aba-b6b3-44de-baeb-b18dac036ca8/crystal-reports-in-c-disable-parameter-prompt?forum=vscrystalreports\" rel=\"nofollow\">here</a></p>\n\n<p><strong>Update</strong></p>\n\n<p>If your store-procedure does what you want. You dont have to change datasource each time. Actually i forgot since during ttx . You can just use Dataset and some trick i normally do. Create and empty database table which you dont need. Add your report columns in the table just like ttx file and set your report source to the emty table which you will never use. And then from the source code. Pass Dataset as your report source example.</p>\n\n<p>If your report has three columns . Name, user name and password. Then create SQL table with columns \nname , user name, password. Use your table just for column names. Set the report datasource to the empty table. Make sure its empty. </p>\n\n<pre><code>SqlConnection conn = new SqlConnection(\"Your Connection String\");\nSqlCommand comm = new SqlCommand(\"Your Store procedure name\", conn); //you can use string query \ncomm.CommandType = CommandType.StoredProcedure; //Or Text when you use sql like when u use ttx b4.\n\nSqlDataAdapter da = new SqlDataAdapter(comm);\n\nda.SelectCommand.CommandTimeout =0;\nDataSet ds = new DataSet(\"Your dataset name\");\nda.Fill(ds);\n\nif(ds.Tables[0].Rows.Count &gt; 0)\n{\n   ReportDocument doc = new ReportDocument(); //Your report Doc instance\n   doc.Load(\"Report FIle path\");\n\n   //Below is important . Here you overwrite the datasource\n   doc.Database.Tables[0].SetDataSource(ds.Tables[0]); //Set your report datasource,\n   report.SetParameterValue(0, Loc); //Set your parameters; //You can manually add the parameters in   your report.\n\n   crViewer.ReportSource = doc; //Set your Report Viewer source .  And you are good to go. \n\n}\n</code></pre>\n\n<p>You can change This report Source how ever you like from query or store procedure as per as the columns are the same. Just override the datasource and you are done. Hope it helps.</p>\n", "last_activity_date": 1476007339, "answer_id": 26478932, "is_accepted": true, "owner": {"user_id": 2270185, "reputation": 1178, "user_type": "registered", "accept_rate": 67, "display_name": "Nuru Salihu", "link": "http://stackoverflow.com/users/2270185/nuru-salihu", "profile_image": "https://www.gravatar.com/avatar/3b15ea1ae8bec574d3506752e7fd4d9d?s=128&d=identicon&r=PG"}, "last_edit_date": 1476007339, "question_id": 26422579}