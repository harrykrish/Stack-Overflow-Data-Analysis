{"title": "Azure traffic manager to use custom request header", "tags": ["azure", "azure-web-sites", "azure-traffic-manager"], "creation_date": 1477642174, "score": 1, "body": "<p>Currently <strong>Traffic Manager</strong> can't probe URIs behind authentication walls. That goes for <a href=\"https://tools.ietf.org/html/rfc2617\" rel=\"nofollow\">Basic HTTP authentication</a> as well.</p>\n\n<p>i.e. If you're responding with a redirect,</p>\n\n<pre><code>HTTP/1.1 302 Found\nLocation: https://token.service\n</code></pre>\n\n<p>Traffic Manager will mark your endpoint <strong>Unhealthy</strong> since it expects a <code>200 OK</code> back.</p>\n\n<p>You'll need a page/controller/route/whathaveyou that doesn't require authentication, and returns <code>200 OK</code> back to the Traffic Manager probe.</p>\n\n<p>e.g. <code>http://example.com/health</code></p>\n\n<p>Put all your health logic in there - you could for example check if your database and Redis cache is healthy, and then return <code>200 OK</code>, else return <code>5xx</code>.</p>\n\n<p>From <a href=\"https://azure.microsoft.com/en-gb/documentation/articles/traffic-manager-monitoring/\" rel=\"nofollow\">https://azure.microsoft.com/en-gb/documentation/articles/traffic-manager-monitoring/</a>:</p>\n\n<blockquote>\n  <h3>Note:</h3>\n  \n  <p>Traffic Manager only considers an endpoint to be online if the return message is 200 OK. An endpoint is unhealthy when any of the following events occur:</p>\n  \n  <ul>\n  <li>A non-200 response is received (including a different 2xx code, or a 301/302 redirect)</li>\n  <li>Request for client authentication</li>\n  <li>Timeout (the timeout threshold is 10 seconds)</li>\n  <li>Unable to connect</li>\n  </ul>\n</blockquote>\n", "last_activity_date": 1477729013, "answer_id": 40300737, "is_accepted": true, "owner": {"user_id": 4148708, "reputation": 2376, "user_type": "registered", "display_name": "evilSnobu", "link": "http://stackoverflow.com/users/4148708/evilsnobu", "profile_image": "https://i.stack.imgur.com/JyCrR.jpg?s=128&g=1"}, "last_edit_date": 1477729013, "question_id": 40290354}