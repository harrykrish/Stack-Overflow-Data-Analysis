{"title": "Trouble pivoting in pandas (spread in R)", "tags": ["python-3.x", "pandas", "pivot", "tidyr", "spread"], "creation_date": 1477361303, "score": 3, "body": "<p>Your last try (with <code>unstack</code>) works fine for me, I'm not sure why it gave you a problem.  FWIW, I think it's more readable to use the index names rather than levels, so I did it like this:</p>\n\n<pre><code>&gt;&gt;&gt; df.set_index(['dt','site_id','eu']).unstack('eu')\n\n            kw    \neu         FGE WSH\ndt site_id        \n1  a         8   5\n   b         3   7\n   c         1   5\n2  a         2   3\n   b         5   7\n   c         2   5\n</code></pre>\n\n<p>But again, your way looks fine to me and is pretty much the same as what @piRSquared did (except their answer adds some more code to get rid of the multi-index).</p>\n\n<p>I think the problem with <code>pivot</code> is that you can only pass a single variable, not a list?  Anyway, this works for me:</p>\n\n<pre><code>&gt;&gt;&gt; df.set_index(['dt','site_id']).pivot(columns='eu')\n</code></pre>\n\n<p>For <code>pivot_table</code>, the main issue is that 'kw' is an object/character and <code>pivot_table</code> will attempt to aggregate with <code>numpy.mean</code> by default.  You probably got the error message:  \"DataError: No numeric types to aggregate\".</p>\n\n<p>But there are a couple of workarounds.  First, you could just convert to a numeric type and then use your same pivot_table command</p>\n\n<pre><code>&gt;&gt;&gt; df['kw'] = df['kw'].astype(int)\n&gt;&gt;&gt; df.pivot_table(index = ['dt','site_id'], values = 'kw', columns = 'eu')\n</code></pre>\n\n<p>Alternatively you could change the aggregation function:</p>\n\n<pre><code>&gt;&gt;&gt; df.pivot_table(index = ['dt','site_id'], values = 'kw', columns = 'eu', \n                   aggfunc=sum )\n</code></pre>\n\n<p>That's using the fact that strings can be summed (concatentated) even though you can't take a mean of them.  Really, you can use most functions here (including lambdas) that operate on strings.  </p>\n\n<p>Note, however, that <code>pivot_table's</code> <code>aggfunc</code> requires some sort of reduction operation here even though you only have a single value per cell, so there actually isn't anything to reduce!  But there is a check in the code that requires a reduction operation, so you have to do one.</p>\n", "last_activity_date": 1477757404, "answer_id": 40230273, "is_accepted": true, "owner": {"user_id": 3877338, "reputation": 6235, "user_type": "registered", "accept_rate": 93, "display_name": "JohnE", "link": "http://stackoverflow.com/users/3877338/johne", "profile_image": "https://www.gravatar.com/avatar/300539394aa55b738b51e6769cca9b3e?s=128&d=identicon&r=PG&f=1"}, "last_edit_date": 1477757404, "question_id": 40229444}