{"title": "UIMarkupTextPrintFormatter never renders base64 images", "tags": ["html", "swift", "pdf", "webview", "uiprintformatter"], "creation_date": 1477757088, "score": 1, "body": "<p>This happens because WebKit first parses the HTML into a DOM, and renders content on multiple event loop cycles. You therefore need to wait for not just the page DOM to be ready but for the resource loading to be complete. As you also suggest, you need to refactor your code such that the webview gets loaded first, and you only then export its contents. </p>\n\n<p>To determine the correct time to fire the export, you can observe for the state of the DOM document in the web view. There are multiple ways to do this, but the most readable option I find is <a href=\"http://stackoverflow.com/a/23240727/504931\">a port of an answer to a related Objective-C question</a>: in your <a href=\"https://developer.apple.com/reference/uikit/uiwebviewdelegate\" rel=\"nofollow\">UIWebViewDelegate</a> implementation, implement <a href=\"https://developer.apple.com/reference/uikit/uiwebviewdelegate/1617969-webviewdidfinishload\" rel=\"nofollow\"><code>webViewDidFinishLoad</code></a> in the following way to monitor <a href=\"https://developer.mozilla.org/en/docs/Web/API/Document/readyState\" rel=\"nofollow\"><code>document.readyState</code></a>: </p>\n\n\n\n<pre><code>    func webViewDidFinishLoad(_ webView: UIWebView) {\n\n        guard let readyState = webView.stringByEvaluatingJavaScript(from: \"document.readyState\"),\n            readyState == \"complete\" else\n        {\n            // document not yet parsed, or resources not yet loaded.\n            return\n        }\n\n        // This is the last webViewDidFinishLoad call --&gt; export.\n        //\n        // There is a problem with this method if you have JS code loading more content:\n        // in that case -webViewDidFinishLoad can get called again still after document.readyState has already been in state 'complete' once or more.\n        self.exportHtmlContentToPDF(\u2026)\n    }\n</code></pre>\n", "last_activity_date": 1477757479, "answer_id": 40320983, "is_accepted": true, "owner": {"user_id": 504931, "reputation": 2224, "user_type": "registered", "display_name": "mz2", "link": "http://stackoverflow.com/users/504931/mz2", "profile_image": "https://www.gravatar.com/avatar/e16e6e49ebd35a14a5e091ab67e538bc?s=128&d=identicon&r=PG"}, "last_edit_date": 1477757479, "question_id": 40239515}