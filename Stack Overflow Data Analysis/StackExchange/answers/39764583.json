{"title": "SaltStack file.recurse per minion", "tags": ["salt-stack"], "creation_date": 1475135964, "score": 1, "body": "<p>There are different ways depending on your use cases and state tree.</p>\n\n<p>The easiest one is to create a separate state and attach this using <code>top.sls</code>.</p>\n\n<p>If you work on formulas, which are configured through pillar. I would write this information somewhere in my pillar. The states then decide based on the pillar data.</p>\n\n<p><strong>pillar.example</strong>:</p>\n\n<pre><code>yourformula:\n  getspecificfile: true\n</code></pre>\n\n<p><strong>somestate.sls</strong>:</p>\n\n<pre><code>{% if salt['pillar.get'](\"yourformula:getspecificfile\") %}\nfiles_per_minion:\n  file.recurse:\n    - source: salt://monitoring/files/per_minion/{{ grains.id }}\n    - name: /\n    - template: jinja\n{% endif %}\n</code></pre>\n\n<p><strong>UPDATE</strong>:</p>\n\n<p>i just had a look in the <a href=\"https://docs.saltstack.com/en/latest/ref/states/all/salt.states.file.html\" rel=\"nofollow\">docs of the file.managed state</a></p>\n\n<blockquote>\n  <p>The source parameter can be specified as a list. If this is done, then the first file to be matched will be the one that is used. This allows you to have a default file on which to fall back if the desired file does not exist on the salt fileserver. Here's an example:</p>\n</blockquote>\n\n<pre><code>/etc/foo.conf:\n  file.managed:\n    - source:\n      - salt://foo.conf.{{ grains['fqdn'] }}\n      - salt://foo.conf.fallback\n    - user: foo\n    - group: users\n    - mode: 644\n    - backup: minion\n</code></pre>\n\n<p>This seems to be another option - if you don't care to roll out empty files which are not necessary on your minions.</p>\n", "last_activity_date": 1475149242, "answer_id": 39764583, "is_accepted": true, "owner": {"user_id": 5992118, "reputation": 839, "user_type": "registered", "display_name": "dahrens", "link": "http://stackoverflow.com/users/5992118/dahrens", "profile_image": "https://www.gravatar.com/avatar/08ae2e7ce567cbfb93d480892bd10fa0?s=128&d=identicon&r=PG"}, "last_edit_date": 1475149242, "question_id": 39764078}