{"title": "How to one-hot-encode factor variables with data.table?", "tags": ["r", "data.table"], "creation_date": 1475864186, "score": 1, "body": "<p>Here's a more generalized version of eddi's solution:</p>\n\n<pre><code>one_hot &lt;- function(dt, cols=\"auto\", dropCols=TRUE, dropUnusedLevels=FALSE){\n  # One-Hot-Encode unordered factors in a data.table\n  # If cols = \"auto\", each unordered factor column in dt will be encoded. (Or specifcy a vector of column names to encode)\n  # If dropCols=TRUE, the original factor columns are dropped\n  # If dropUnusedLevels = TRUE, unused factor levels are dropped\n\n  # Automatically get the unordered factor columns\n  if(cols[1] == \"auto\") cols &lt;- colnames(dt)[which(sapply(dt, function(x) is.factor(x) &amp; !is.ordered(x)))]\n\n  # Build tempDT containing and ID column and 'cols' columns\n  tempDT &lt;- dt[, cols, with=FALSE]\n  tempDT[, ID := .I]\n  setcolorder(tempDT, unique(c(\"ID\", colnames(tempDT))))\n  for(col in cols) set(tempDT, j=col, value=factor(paste(col, tempDT[[col]], sep=\"_\"), levels=paste(col, levels(tempDT[[col]]), sep=\"_\")))\n\n  # One-hot-encode\n  if(dropUnusedLevels == TRUE){\n    newCols &lt;- dcast(melt(tempDT, id = 'ID', value.factor = T), ID ~ value, drop = T, fun = length)\n  } else{\n    newCols &lt;- dcast(melt(tempDT, id = 'ID', value.factor = T), ID ~ value, drop = F, fun = length)\n  }\n\n  # Combine binarized columns with the original dataset\n  result &lt;- cbind(dt, newCols[, !\"ID\"])\n\n  # If dropCols = TRUE, remove the original factor columns\n  if(dropCols == TRUE){\n    result &lt;- result[, !cols, with=FALSE]\n  }\n\n  return(result)\n}\n</code></pre>\n\n<p>Note that for large datasets it's probably better to use <code>Matrix::sparse.model.matrix</code></p>\n", "last_activity_date": 1475864873, "answer_id": 39923539, "is_accepted": false, "owner": {"user_id": 2146894, "reputation": 3250, "user_type": "registered", "accept_rate": 81, "display_name": "Ben", "link": "http://stackoverflow.com/users/2146894/ben", "profile_image": "https://www.gravatar.com/avatar/1fe765256b6985ff92d0554dbcf021aa?s=128&d=identicon&r=PG"}, "last_edit_date": 1475864873, "question_id": 39905820}