{"title": "Trying to loop through HTML tables and create a data frame", "tags": ["r", "web-scraping", "rvest"], "creation_date": 1477502573, "score": 1, "body": "<p>Try this answer! I fixed the creation of the URL and set up a master data frame to store the requested information.  The page is dynamically generated so using these the standard tools from rvest is not going to work.  All of  player (about 16 fields), college and pick information is stored on the page, it is a matter of searching for it and extracting it.</p>\n\n<pre><code>library(rvest)\nlibrary(stringr)\nlibrary(dplyr)\n\n#create a master dataframe to store all of the results\ncomplete&lt;-data.frame()\n\nyearsVector &lt;- c( \"2011\", \"2012\", \"2013\", \"2014\", \"2015\")\n#all position information is stored on each page no need to create sparate queries\n#positionVector &lt;- c(\"qb\", \"rb\", \"wr\", \"te\", \"ol\", \"dl\", \"lb\", \"cb\", \"s\")\npositionVector &lt;- c(\"qb\")\nfor (i in 1:length(yearsVector)) \n{\n  for (j in 1:length(positionVector)) \n  {\n    # create a url template \n    URL.base&lt;-\"http://www.nfl.com/draft/\"\n    URL.intermediate &lt;- \"/tracker?icampaign=draft-sub_nav_bar-drafteventpage-tracker#dt-tabs:dt-by-position/dt-by-position-input:\"\n    #create the dataframe with the dynamic values\n    URL &lt;- paste0(URL.base, yearsVector[i], URL.intermediate, positionVector[j])\n    print(yearsVector[i])\n    print(URL)\n\n    #read the page - store the page to make debugging easier\n    page&lt;- read_html(URL)\n\n    #This needs work since the page is dynamicly generated.\n    #DF &lt;- html_nodes(page, xpath = \".//table\") %&gt;% html_table(fill=TRUE)\n    #About 539 names returned, may need to search and extracted requested info.\n    #find records for each player\n    playersloc&lt;-str_locate_all(page, \"\\\\{\\\"personId.*?\\\\}\")[[1]]\n    players&lt;-str_sub(page, playersloc[,1]+1, playersloc[,2]-1)\n    #fix the cases where the players are named Jr.\n    players&lt;-gsub(\", \", \"_\", players  )\n\n    #split and reshape the data in a data frame\n    play2&lt;-strsplit(gsub(\"\\\"\", \"\", players), ',')\n    data&lt;-sapply(strsplit(unlist(play2), \":\"), FUN=function(x){x[2]})\n    df&lt;-data.frame(matrix(data, ncol=16, byrow=TRUE))\n    #name the column names\n    names(df)&lt;-sapply(strsplit(unlist(play2[1]), \":\"), FUN=function(x){x[1]})\n\n    #sort out the pick information\n    picks&lt;-str_locate_all(page, \"\\\\{\\\"id.*?player.*?\\\\}\")[[1]]\n    picks&lt;-str_sub(page, picks[,1]+1, picks[,2]-1)\n    #fix the cases where there are commas in the notes section.\n    picks&lt;-gsub(\", \", \"_\", picks  )\n    picks&lt;-strsplit(gsub(\"\\\"\", \"\", picks), ',')\n    data&lt;-sapply(strsplit(unlist(picks), \":\"), FUN=function(x){x[2]})\n    picksdf&lt;-data.frame(matrix(data, ncol=6, byrow=TRUE))\n    names(picksdf)&lt;-sapply(strsplit(unlist(picks[1]), \":\"), FUN=function(x){x[1]})\n\n    #sort out the college information\n    schools&lt;-str_locate_all(page, \"\\\\{\\\"id.*?name.*?\\\\}\")[[1]]\n    schools&lt;-str_sub(page, schools[,1]+1, schools[,2]-1)\n    schools&lt;-strsplit(gsub(\"\\\"\", \"\", schools), ',')\n    data&lt;-sapply(strsplit(unlist(schools), \":\"), FUN=function(x){x[2]})\n    schoolsdf&lt;-data.frame(matrix(data, ncol=3, byrow=TRUE))\n    names(schoolsdf)&lt;-sapply(strsplit(unlist(schools[1]), \":\"), FUN=function(x){x[1]})\n\n    #merge the 3 tables together\n    df&lt;-left_join(df, schoolsdf, by=c(\"college\" =  \"id\"))\n    df&lt;-left_join(df, picksdf, by=c(\"pick\" =  \"id\"))\n\n    #store the temp values into the master dataframe\n    complete&lt;-rbind(complete, df)\n  }\n}\n</code></pre>\n\n<p>Figuring out the correct regular expression to find and locate the required information was tricky.  It looks like the data from 2010 uses a different format use college information thus I left that year out.\nAlso, please make sure you are not violating the terms of service on this site.\nGood luck</p>\n", "last_activity_date": 1477662279, "answer_id": 40268516, "is_accepted": true, "owner": {"user_id": 5792244, "reputation": 2215, "user_type": "registered", "display_name": "Dave2e", "link": "http://stackoverflow.com/users/5792244/dave2e", "profile_image": "https://www.gravatar.com/avatar/7b8b7f62698a5d33a0bf49f47118d32b?s=128&d=identicon&r=PG&f=1"}, "last_edit_date": 1477662279, "question_id": 40264390}