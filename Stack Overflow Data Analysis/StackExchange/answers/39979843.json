{"title": "Using Amazon AWS Cognito `.well-known/jwks.json` data fails to base64 decode some fields", "tags": ["java", "amazon-web-services", "kotlin", "amazon-cognito"], "creation_date": 1476196709, "score": 1, "body": "<p>The issue is that the Amazon AWS Cognito team is using two different Base64 encoding alphabets for basically the same thing.  So you will need to detect which is being used.</p>\n\n<p>If the encoded string ends with <code>=</code> or contains <code>+</code> or <code>/</code> then it is definitely the normal <code>Base64.getDecoder()</code>.  If it contains a <code>-</code> or <code>_</code> then it is definitely the <code>Base64.getUrlDecoder()</code>.  Otherwise nothing special is there and it is best to use the <code>Base64.getUrlDecoder()</code> because you do not know if the length would need padding or not.</p>\n\n<p>This translates to (<em>in Kotlin, but logically is applicable to any language</em>):</p>\n\n\n\n<pre><code>fun base64SafeDecoder(encoded: String): ByteArray {\n    val decoder = if (encoded.endsWith('=') || encoded.any { it == '+' || it == '/' }) {\n        Base64.getDecoder()\n    }\n    else {\n        Base64.getUrlDecoder()\n    }\n    return decoder.decode(encoded.toByteArray())\n}\n</code></pre>\n\n<p>This would be a problem for any language that has Base64 decoding in that they might be loose and ignore the invalid character (some do), or they might be strict and throw an exception.  Some test websites for Base64 encoding/decoding exhibit both of these behaviors as well, and the silent ignoring of invalid characters is dangerous.  You would then have an error later using the results of the decoding later.</p>\n", "last_activity_date": 1476198524, "answer_id": 39979843, "is_accepted": true, "owner": {"user_id": 3679676, "reputation": 12075, "user_type": "registered", "accept_rate": 100, "display_name": "Jayson Minard", "link": "http://stackoverflow.com/users/3679676/jayson-minard", "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG"}, "last_edit_date": 1476198524, "question_id": 39979842}