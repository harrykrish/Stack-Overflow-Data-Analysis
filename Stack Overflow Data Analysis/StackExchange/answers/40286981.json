{"title": "Singleton Inheritance Buggy Behavior", "tags": ["node.js", "ecmascript-6", "extends", "es6-class"], "creation_date": 1477577738, "score": 1, "body": "<p>You are doing something a bit strange. Constructors and subclasses in ecmascript 6 do not work in the way you think they do. You may wish to read <a href=\"http://www.2ality.com/2015/02/es6-classes-final.html\" rel=\"nofollow\">this blog post</a> (particularly section 4) to learn more.</p>\n\n<p>Taking from that article, your code looks like this under the hood:</p>\n\n<pre><code>let instanceOne = null;\n\nfunction One() {\n//  var this = Object.create(new.target.prototype);  // under the hood\n\n    if (instanceOne) return instanceOne;\n\n    this.name = 'one';\n    instanceOne = this;\n    return instanceOne;\n}\nOne.prototype.method = function() { console.log('Method in one'); }\n\nlet instanceTwo = null;\n\nfunction Two() {\n    var that = undefined;\n\n    that = Reflect.construct(One, [], new.target);\n\n    if (instanceTwo) return instanceTwo;\n\n    that.name = 'two';\n    instanceTwo = that;\n    return instanceTwo;\n}\nTwo.prototype.method = function() { console.log('Method in two'); }\nObject.setPrototypeOf(Two, One);\nObject.setPrototypeOf(Two.prototype, One.prototype);\n\nconst objOne = Reflect.construct(One, [], One);\nconst objTwo = Reflect.construct(Two, [], Two);\n\nconsole.log(objOne.name);\nconsole.log(objTwo.name);\nobjOne.method();\nobjTwo.method();\n</code></pre>\n\n<p>(new.target is the value passed as the third argument of <code>Reflect.construct</code>)</p>\n\n<p>You can see that for the <code>Two</code> class, no new object is being created and <code>Two.prototype</code> is not used. Instead, the <code>One</code> singleton instance is used and mutated.</p>\n", "last_activity_date": 1477745075, "answer_id": 40286981, "is_accepted": true, "owner": {"user_id": 284741, "reputation": 4937, "user_type": "registered", "accept_rate": 95, "display_name": "Oliver", "link": "http://stackoverflow.com/users/284741/oliver", "profile_image": "https://www.gravatar.com/avatar/e209bcc34ced5624bc4240b713d2ab73?s=128&d=identicon&r=PG"}, "last_edit_date": 1477745075, "question_id": 40285648}