{"title": "Duplicates in Union", "tags": ["sql-server", "tsql", "union", "sql-server-2012-express"], "creation_date": 1477573852, "score": 1, "body": "<p>The behavior of <code>UNION</code> is to return unique rows when every column in the unioned datasets match.</p>\n\n<p>You have two selects which are apparently always going to give different results due to the nulls assigned for many columns.</p>\n\n<p>Perhaps if you re-wrote this as a <code>JOIN</code> of two datasets you would get the result that you want.</p>\n\n<p>Assuming you have a single row on each cte which you want to join below is an example;</p>\n\n<pre><code>WITH cte_Assignment AS\n(\n    SELECT\n        stock_items.stock_number       AS 'STOCK NUMBER',\n        SUM(stock_assign.turnover)     AS 'TURNOVER',\n        SUM(stock_assign.days_on_hire) AS 'DAYS ON HIRE'\n    FROM stock_assign\n    LEFT JOIN stock_items\n        ON stock_assign.stock_number = stock_items.stock_number\n    LEFT JOIN depots\n        ON depot_id = depots.dpt_id\n    GROUP BY\n        stock_items.stock_number\n)\n\n, cte_Item AS\n(\n    SELECT\n        stock_items.item_id         AS 'ITEM_ID',\n        stock_items.stock_number    AS 'STOCK NUMBER',\n        stock_items.equipment_class AS ' CAT',\n        stock_items.name            AS 'ITEM NAME',\n        depots.dpt_name             AS 'DEPOT LOC',\n        stock_items.disposal_date   AS 'DISPOSAL DATE',\n        stock_items.disposal_type   AS 'DISPOSAL TYPE',\n        stock_items.date_available  AS 'DATE CREATED',\n        users.usr_name              AS 'CREATED BY',\n        fixed_assets.cost_amount    AS 'COST PRICE'\n    FROM stock_items\n    LEFT JOIN users\n        ON users.usr_id = stock_items.userid_created\n    LEFT JOIN depots\n        ON stock_items.depot_id_located_at = depots.dpt_id\n    LEFT JOIN fixed_assets\n        ON stock_items.item_id = fixed_assets.stock_item_id\n)\n\nSELECT\n    item.[ITEM_ID],\n    item.[STOCK NUMBER],\n    assignment.[TURNOVER],\n    assignment.[DAYS ON HIRE],\n    item.[ CAT],\n    item.[ITEM NAME],\n    item.[DEPOT LOC],\n    item.[DISPOSAL DATE],\n    item.[DISPOSAL TYPE],\n    item.[DATE CREATED],\n    item.[CREATED BY],\n    item.[COST PRICE]\nFROM cte_Assignment assignment\nINNER JOIN cte_Item item\n    on item.[STOCK NUMBER] = assignment.[STOCK NUMBER]\n\nORDER  BY item.[STOCK NUMBER] ASC \n</code></pre>\n", "last_activity_date": 1477585691, "answer_id": 40285475, "is_accepted": true, "owner": {"user_id": 1849866, "reputation": 771, "user_type": "registered", "display_name": "Edward Comeau", "link": "http://stackoverflow.com/users/1849866/edward-comeau", "profile_image": "https://i.stack.imgur.com/6xUJ6.jpg?s=128&g=1"}, "last_edit_date": 1477585691, "question_id": 40285218}