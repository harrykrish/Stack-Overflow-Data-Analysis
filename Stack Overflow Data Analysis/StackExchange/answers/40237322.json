{"title": "Changing a class with javassist (java reflexion)", "tags": ["java", "javassist"], "creation_date": 1477390685, "score": 0, "body": "<p>You should load both origin and modified versions of class in the different class loaders.\nTry this:  </p>\n\n<pre><code>public static void main(String[] args) {\n     try {\n         ClassPool pool = ClassPool.getDefault();\n         Loader cl = new Loader(pool); //javassist.Loader\n         // version original\n         Class origin = cl.loadClass(\"testjavasisit.Hello\");\n         Object h1 =  origin.newInstance();\n         Method sayMethod =  origin.getMethod(\"say\", null);\n         sayMethod.invoke(h1);\n\n            CtClass cc = pool.get(\"testjavasisit.Hello\");\n            cc.defrost();\n            CtMethod m = cc.getDeclaredMethod(\"say\");\n            m.insertBefore(\"{ System.out.println(\\\"Hello.say():\\\"); }\");\n            cc.writeFile(\".\");\n            cc.toClass();\n            // version modifie            \n            Hello h2 = new Hello();\n            h2.say();\n    } catch (Throwable e) {\n        e.printStackTrace();\n    }\n}   \n</code></pre>\n\n<p>If your goal is to modify already loaded class at the same classloader you might use <a href=\"http://docs.oracle.com/javase/6/docs/technotes/guides/instrumentation/\" rel=\"nofollow\">Java Instrument API</a> \nto <a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/instrument/Instrumentation.html#retransformClasses%28java.lang.Class...%29\" rel=\"nofollow\">retransform</a> class after javaasist worked</p>\n", "last_activity_date": 1477392074, "answer_id": 40237322, "is_accepted": false, "owner": {"user_id": 7022735, "reputation": 13, "user_type": "registered", "display_name": "rvit34", "link": "http://stackoverflow.com/users/7022735/rvit34", "profile_image": "https://i.stack.imgur.com/DZnj9.jpg?s=128&g=1"}, "last_edit_date": 1477392074, "question_id": 40105981}