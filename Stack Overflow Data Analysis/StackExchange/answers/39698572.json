{"title": "PHP send email foreach user", "tags": ["php", "mysql", "sql", "email", "foreach"], "creation_date": 1474880330, "score": 0, "body": "<p>Your code was missing some curly brackets ( {} ):</p>\n\n<pre><code>include (\"../dbconnect.php\");\n\n$sql='SELECT c.endofmonthform, c.startofmonthform, c.email, c.id, c.formlevel, c.mastersite, c.opmanager, u.userEmail FROM `clients` as c LEFT JOIN `users` as u on c.opmanager = u.userName WHERE endofmonthform=\"22/09/2016\"'; //TODAYS DATE BACK HERE!\n\n$result=mysql_query($sql); \n\n while($row=mysql_fetch_array($result)){  \n\n    $enddate = $row['endofmonthform']; // End\n\n    $startdate = $row['startofmonthform']; // Start\n\n    $email = $row['email']; //Email to send email to\n\n    $id = $row['id'];\n\n    $formlevel = $row['formlevel']; //To update and check formlevel\n\n    $sitegroupname = $row['mastersite'];\n\n    $manager = $row['opmanager'];\n\n    $opemail = $row['userEmail'];\n\n    /* If end date is today and form level is still ZERO then send email to op manager */\n    $mail = new EMail;\n\n    $mail-&gt;Username = 'Sender email';    \n    $mail-&gt;Password = 'mypwd';\n    $mail-&gt;SetFrom(\"senderemail@example.com\",\"companyname\");  \n    $mail-&gt;ContentType = \"text/html\";\n    $mail-&gt;Subject = \"Client feedback incomplete NEW LAYOUT\";\n\n    //Enter the email address you wish to send TO (Name is an optional friendly name):\n    $mail-&gt;AddTo($opemail,$manager);\n\n\n    $mail-&gt;Message = \"&lt;!DOCTYPE html PUBLIC  -//W3C//DTD XHTML 1.0 Transitional//EN   http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd &gt;\n    &lt;html xmlns=http://www.w3.org/1999/xhtml&gt;\n    &lt;head&gt;\n    &lt;meta http-equiv=Content-Type  content=text/html; charset=utf-8 /&gt;\n    &lt;title&gt;&lt;/title&gt;\n    &lt;style type=text/css &gt;\n    body {margin: 0; padding: 0; min-width: 100%!important;}\n    .content {width: 100%; max-width: 600px;}  \n    &lt;/style&gt;\n    &lt;/head&gt;\n    &lt;body yahoo bgcolor=#f6f8f1 &gt;\n    &lt;table width=100% bgcolor=#f6f8f1 border=0 cellpadding=0 cellspacing=0&gt;\n    &lt;tr&gt;\n    &lt;td&gt;\n    &lt;table class=content  align=center  cellpadding=0  cellspacing=0  border=0 &gt;\n    &lt;tr&gt;\n    &lt;td&gt;\n\n    ID: \".$id.\" &lt;br&gt;\n\n    Clients group name: \".$sitegroupname.\" &lt;br&gt;\n\n    Managers Name: \".$manager.\" &lt;br&gt;\n\n    Managers Email: \".$useremail.\" &lt;br&gt;\n\n    Please log into your account as you have feedback notifications\n    &lt;br&gt;\n\n    &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n    &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/table&gt;\n    &lt;/body&gt;\n    &lt;/html&gt;\";\n\n    echo $success = $mail-&gt;Send(); //Send the email.\n}\n</code></pre>\n\n<p>Also cleaned up some of the PHP to simplify the entire thing.\nNOTE: I excluded the email class as it isn't relevant to this problem.</p>\n\n<p>EDIT:</p>\n\n<p>TS informed me that the mail part wasn't working, so try using the default php mailer:</p>\n\n<pre><code>&lt;?php \ninclude (\"../dbconnect.php\");\n\n$sql='SELECT c.endofmonthform, c.startofmonthform, c.email, c.id, c.formlevel, c.mastersite, c.opmanager, u.userEmail FROM `clients` as c LEFT JOIN `users` as u on c.opmanager = u.userName WHERE endofmonthform=\"22/09/2016\"'; //TODAYS DATE BACK HERE!\n\n$result=mysql_query($sql); \n\n while($row=mysql_fetch_array($result)){  \n\n    $enddate = $row['endofmonthform']; // End\n\n    $startdate = $row['startofmonthform']; // Start\n\n    $email = $row['email']; //Email to send email to\n\n    $id = $row['id'];\n\n    $formlevel = $row['formlevel']; //To update and check formlevel\n\n    $sitegroupname = $row['mastersite'];\n\n    $manager = $row['opmanager'];\n\n    $opemail = $row['userEmail'];\n\n    mail($opemail, \"subject\", \"message\", \"from\");\n}\n</code></pre>\n", "last_activity_date": 1474883057, "answer_id": 39698572, "is_accepted": true, "owner": {"user_id": 5033031, "reputation": 464, "user_type": "registered", "accept_rate": 80, "display_name": "Rick van Lieshout", "link": "http://stackoverflow.com/users/5033031/rick-van-lieshout", "profile_image": "https://lh5.googleusercontent.com/-K3kbNrRBQ2g/AAAAAAAAAAI/AAAAAAAAATE/XxcsC4rT39o/photo.jpg?sz=128"}, "last_edit_date": 1474883057, "question_id": 39662791}